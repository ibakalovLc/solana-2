{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivaylobakalov/web3/solana/voting-dapp/frontend/src/app/api/vote/route.tsx"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { ActionGetResponse, ActionPostRequest, ACTIONS_CORS_HEADERS, createPostResponse } from '@solana/actions'\nimport { Connection, PublicKey, Keypair, Transaction } from '@solana/web3.js'\nimport { Program, AnchorProvider, BN } from '@coral-xyz/anchor'\n\nimport IDL from '@/../../voting/target/idl/voting.json'\nimport { type Voting } from '@/../../voting/target/types/voting'\n\nexport const OPTIONS = GET;\n\nexport async function GET(request: NextRequest) {\n\n    const connection = new Connection('http://localhost:8899', 'confirmed');\n    const program = new Program<Voting>(IDL, { connection });\n    const pollId = new BN(1);\n    const candidateCranchyName = 'Cranchy';\n    const candidateSmoothName = 'Smooth';\n\n    const [candidateCranchyAddress] = PublicKey.findProgramAddressSync(\n        [Buffer.from(\"candidate\"), pollId.toArrayLike(Buffer, \"le\", 8), Buffer.from(candidateCranchyName)],\n        program.programId\n      );    \n\n    const [candidateSmoothAddress] = PublicKey.findProgramAddressSync(\n    [Buffer.from(\"candidate\"), pollId.toArrayLike(Buffer, \"le\", 8), Buffer.from(candidateSmoothName)],\n    program.programId\n    );\n\n     const candidateCranchy = await program.account.candidate.fetch(candidateCranchyAddress);\n     const candidateSmooth = await program.account.candidate.fetch(candidateSmoothAddress);\n\n\n  const actionMetaData: ActionGetResponse = {\n    icon: 'https://thumbs.dreamstime.com/z/peanut-butter-15388988.jpg?ct=jpeg',\n    title: 'Vote for your favorite type of peanut butter',\n    description: 'Vote between Cranchy, Smooth peanut butter',\n    label: 'Vote',\n    links: {\n        actions: [\n            {\n                label: `${candidateCranchy.candidateName} - ${candidateCranchy.candidateVotes}`,\n                href: '/api/vote?candidate=Cranchy',\n                type: 'transaction',\n            },\n            {\n                label: `${candidateSmooth.candidateName} - ${candidateSmooth.candidateVotes}`,\n                href: '/api/vote?candidate=Smooth',\n                type: 'transaction',\n            },\n        ]\n    },\n  }\n\n  return NextResponse.json(actionMetaData, { headers: ACTIONS_CORS_HEADERS })\n}\n\nexport async function POST(request: NextRequest) {\n  const connection = new Connection('http://localhost:8899', 'confirmed');\n  const program = new Program(IDL, { connection });\n\n  const url = new URL(request.url)\n  const candidate = url.searchParams.get('candidate')\n\n  if (candidate !== 'Cranchy' && candidate !== 'Smooth') {\n    return NextResponse.json({ error: 'Missing candidate' }, { status: 400, headers: ACTIONS_CORS_HEADERS })\n  }\n\n  const body: ActionPostRequest = await request.json()\n  let voter: PublicKey;\n\n  try {\n    voter = new PublicKey(body.account);\n\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to vote' }, { status: 500, headers: ACTIONS_CORS_HEADERS })\n  }\n\n   const instruction = await program.methods.vote(candidate, new BN(1)).accounts({\n    signer: voter,\n  }\n  ).instruction()\n\n  const blockhash = await connection.getLatestBlockhash();\n\n  const transaction = new Transaction({\n    feePayer: voter,    \n    blockhash: blockhash.blockhash,\n    lastValidBlockHeight: blockhash.lastValidBlockHeight,\n  }).add(instruction)\n\n  const response = await createPostResponse({\n    fields: {\n        type: 'transaction',\n        transaction,\n    },\n  })\n\n  return NextResponse.json(response, { headers: ACTIONS_CORS_HEADERS })\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAEA;;;;;;AAGO,MAAM,UAAU;AAEhB,eAAe,IAAI,OAAoB;IAE1C,MAAM,aAAa,IAAI,yLAAU,CAAC,yBAAyB;IAC3D,MAAM,UAAU,IAAI,oMAAO,CAAS,oHAAG,EAAE;QAAE;IAAW;IACtD,MAAM,SAAS,IAAI,0LAAE,CAAC;IACtB,MAAM,uBAAuB;IAC7B,MAAM,sBAAsB;IAE5B,MAAM,CAAC,wBAAwB,GAAG,wLAAS,CAAC,sBAAsB,CAC9D;QAAC,OAAO,IAAI,CAAC;QAAc,OAAO,WAAW,CAAC,QAAQ,MAAM;QAAI,OAAO,IAAI,CAAC;KAAsB,EAClG,QAAQ,SAAS;IAGrB,MAAM,CAAC,uBAAuB,GAAG,wLAAS,CAAC,sBAAsB,CACjE;QAAC,OAAO,IAAI,CAAC;QAAc,OAAO,WAAW,CAAC,QAAQ,MAAM;QAAI,OAAO,IAAI,CAAC;KAAqB,EACjG,QAAQ,SAAS;IAGhB,MAAM,mBAAmB,MAAM,QAAQ,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC;IAC/D,MAAM,kBAAkB,MAAM,QAAQ,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC;IAGjE,MAAM,iBAAoC;QACxC,MAAM;QACN,OAAO;QACP,aAAa;QACb,OAAO;QACP,OAAO;YACH,SAAS;gBACL;oBACI,OAAO,GAAG,iBAAiB,aAAa,CAAC,GAAG,EAAE,iBAAiB,cAAc,EAAE;oBAC/E,MAAM;oBACN,MAAM;gBACV;gBACA;oBACI,OAAO,GAAG,gBAAgB,aAAa,CAAC,GAAG,EAAE,gBAAgB,cAAc,EAAE;oBAC7E,MAAM;oBACN,MAAM;gBACV;aACH;QACL;IACF;IAEA,OAAO,4JAAY,CAAC,IAAI,CAAC,gBAAgB;QAAE,SAAS,wLAAoB;IAAC;AAC3E;AAEO,eAAe,KAAK,OAAoB;IAC7C,MAAM,aAAa,IAAI,yLAAU,CAAC,yBAAyB;IAC3D,MAAM,UAAU,IAAI,oMAAO,CAAC,oHAAG,EAAE;QAAE;IAAW;IAE9C,MAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;IAC/B,MAAM,YAAY,IAAI,YAAY,CAAC,GAAG,CAAC;IAEvC,IAAI,cAAc,aAAa,cAAc,UAAU;QACrD,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;YAAK,SAAS,wLAAoB;QAAC;IACxG;IAEA,MAAM,OAA0B,MAAM,QAAQ,IAAI;IAClD,IAAI;IAEJ,IAAI;QACF,QAAQ,IAAI,wLAAS,CAAC,KAAK,OAAO;IAEpC,EAAE,OAAO,OAAO;QACd,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;YAAK,SAAS,wLAAoB;QAAC;IACrG;IAEC,MAAM,cAAc,MAAM,QAAQ,OAAO,CAAC,IAAI,CAAC,WAAW,IAAI,0LAAE,CAAC,IAAI,QAAQ,CAAC;QAC7E,QAAQ;IACV,GACE,WAAW;IAEb,MAAM,YAAY,MAAM,WAAW,kBAAkB;IAErD,MAAM,cAAc,IAAI,0LAAW,CAAC;QAClC,UAAU;QACV,WAAW,UAAU,SAAS;QAC9B,sBAAsB,UAAU,oBAAoB;IACtD,GAAG,GAAG,CAAC;IAEP,MAAM,WAAW,MAAM,IAAA,+LAAkB,EAAC;QACxC,QAAQ;YACJ,MAAM;YACN;QACJ;IACF;IAEA,OAAO,4JAAY,CAAC,IAAI,CAAC,UAAU;QAAE,SAAS,wLAAoB;IAAC;AACrE","debugId":null}}]
}